FUNCTION /SKN/F_SW_10_06_SPRAS_DESC_CHK .
*"----------------------------------------------------------------------
*"*"Local Interface:
*"  EXPORTING
*"     VALUE(IS_ALERT) TYPE  CHAR1
*"  TABLES
*"      T_SELECT STRUCTURE  RSSELECT
*"      T_DATA STRUCTURE  /SKN/S_SW_10_06_SPRAS_DESC_CH
*"----------------------------------------------------------------------
  DATA_SINGLE: BACKDAYS         INT4,
               LANG_REF_FLD     NAME_FELD,
               SW_DEST          RFCDEST
               .
  LV_LANG_REF_FLD = 'KOSTL'.
  DATA_MULTY: KOKRS KOKRS,
              KOSTL KOSTL,
              DATBI DATBI,
              SPRAS SPRAS,
              DATAB DATAB,
              ERSDA ERFDT,
              BUKRS BUKRS,
              PRCTR PRCTR.
  DATA: DATE_FROM LIKE SY-DATUM,
        DATE_TO   LIKE SY-DATUM.
  DATA: LV_TABIX TYPE I.
  DATA: LS_DATA LIKE LINE OF T_DATA[],
        LS_CSKT TYPE CSKT.
  DATA: LT_DATA LIKE TABLE OF T_DATA,
        LT_CSKT TYPE TABLE OF CSKT.
  DATA: SY_DATLO LIKE SY-DATLO,
        SY_TIMLO LIKE SY-TIMLO.
  SELECT_SINGLE: BACKDAYS,
                 LANG_REF_FLD,
                 SW_DEST.
  SELECT_MULTY: KOKRS,
                KOSTL,
                DATBI,
                SPRAS,
                DATAB,
                ERSDA,
                BUKRS,
                PRCTR.
* if sw_dest is empty then on premise, else on cloud
  IF LV_SW_DEST IS NOT INITIAL.
    CALL FUNCTION '/SKN/FC_SW_10_06_SPRAS_DSC_CH'
      IMPORTING
        IS_ALERT = IS_ALERT
      TABLES
        T_SELECT = T_SELECT
        T_DATA   = T_DATA.
  ENDIF.
  CHECK LV_SW_DEST IS INITIAL.
  CHECK R_SPRAS IS NOT INITIAL.
" Valid from
  IF R_DATAB[] IS INITIAL.
    RS_DATAB-SIGN   = 'I' .
    RS_DATAB-OPTION = 'LE' .
    DATE_FROM       = SY-DATUM.
    RS_DATAB-LOW    = DATE_FROM.
    APPEND RS_DATAB TO R_DATAB.
  ENDIF.
* Valid to
  IF R_DATBI[] IS INITIAL .
    RS_DATBI-SIGN   = 'I' .
    RS_DATBI-OPTION = 'GE' .
    DATE_FROM       = SY-DATUM.
    RS_DATBI-LOW    = DATE_FROM.
    APPEND RS_DATBI TO R_DATBI.
  ENDIF.
* Set 'Created on' date
  IF R_ERSDA[] IS INITIAL AND LV_BACKDAYS IS NOT INITIAL.
    RS_ERSDA-SIGN   = 'I' .
    RS_ERSDA-OPTION = 'BT' .
    DATE_FROM       = SY-DATUM - LV_BACKDAYS.
    DATE_TO         = SY-DATUM.
    RS_ERSDA-LOW    = DATE_FROM.
    RS_ERSDA-HIGH   = DATE_TO.
    APPEND RS_ERSDA TO R_ERSDA.
  ENDIF.
  IF R_KOSTL IS NOT INITIAL.
    LOOP AT R_KOSTL[] INTO RS_KOSTL.
      CALL FUNCTION 'CONVERSION_EXIT_ALPHA_INPUT'
        EXPORTING
          INPUT         = RS_KOSTL-LOW
        IMPORTING
          OUTPUT        = RS_KOSTL-LOW
          .
      IF RS_KOSTL-HIGH IS NOT INITIAL.
        CALL FUNCTION 'CONVERSION_EXIT_ALPHA_INPUT'
        EXPORTING
          INPUT         = RS_KOSTL-HIGH
        IMPORTING
          OUTPUT        = RS_KOSTL-HIGH
          .
      ENDIF.
      MODIFY R_KOSTL[] FROM RS_KOSTL.
    ENDLOOP.
  ENDIF.
  CASE LV_LANG_REF_FLD.
* Description missing check according to cost center language
    WHEN 'KOSTL'.
      SELECT *
        FROM CSKS LEFT OUTER JOIN CSKT ON  CSKS~SPRAS EQ CSKT~SPRAS
                                       AND CSKS~KOKRS EQ CSKT~KOKRS
                                       AND CSKS~KOSTL EQ CSKT~KOSTL
                                       AND CSKS~DATBI EQ CSKT~DATBI
        INTO CORRESPONDING FIELDS OF TABLE T_DATA
        WHERE CSKS~KOKRS IN R_KOKRS
        AND   CSKS~KOSTL IN R_KOSTL
        AND   CSKS~DATBI IN R_DATBI
        AND   CSKS~DATAB IN R_DATAB
        AND   CSKS~ERSDA IN R_ERSDA
        AND   CSKS~SPRAS IN R_SPRAS
        AND   CSKS~SPRAS NE SPACE.
* Description missing check according to company code language
    WHEN 'BUKRS'.
      SELECT CSKS~KOKRS CSKS~KOSTL CSKS~DATBI CSKS~BUKRS CSKS~GSBER
             CSKS~KOSAR CSKS~VERAK CSKS~VERAK_USER CSKS~WAERS
             CSKS~PRCTR CSKS~WERKS CSKS~BKZKP CSKS~PKZKP CSKS~BKZKS
             CSKS~BKZER CSKS~BKZOB CSKS~PKZKS CSKS~PKZER CSKS~MGEFL
             CSKS~MGEFL CSKS~FUNC_AREA T001~SPRAS AS SPRAS_ADD
        FROM CSKS INNER JOIN T001 ON CSKS~BUKRS EQ T001~BUKRS
        INTO CORRESPONDING FIELDS OF TABLE T_DATA
        WHERE CSKS~KOKRS IN R_KOKRS
        AND   CSKS~KOSTL IN R_KOSTL
        AND   CSKS~DATBI IN R_DATBI
        AND   CSKS~DATAB IN R_DATAB
        AND   CSKS~ERSDA IN R_ERSDA
        AND   CSKS~BUKRS IN R_BUKRS
        AND   CSKS~SPRAS IN R_SPRAS
        AND   T001~SPRAS NE SPACE.
*   Description missing check according to profit center language
    WHEN 'PRCTR'.
      SELECT CSKS~KOKRS CSKS~KOSTL CSKS~DATBI CSKS~BUKRS CSKS~GSBER
             CSKS~KOSAR CSKS~VERAK CSKS~VERAK_USER CSKS~WAERS
             CSKS~PRCTR CSKS~WERKS CSKS~BKZKP CSKS~PKZKP CSKS~BKZKS
             CSKS~BKZER CSKS~BKZOB CSKS~PKZKS CSKS~PKZER CSKS~MGEFL
             CSKS~MGEFL CSKS~FUNC_AREA
             CEPC~KOKRS CEPC~PRCTR CEPC~DATBI CEPC~DATAB CEPC~BUKRS
             CEPC~VERAK CEPC~VERAK_USER CEPC~WAERS CEPC~KHINR
             CEPC~LOCK_IND CEPC~SPRAS AS SPRAS_ADD
        FROM CSKS INNER JOIN CEPC ON  CSKS~PRCTR EQ CEPC~PRCTR
        INTO CORRESPONDING FIELDS OF TABLE T_DATA
        WHERE CSKS~KOKRS IN R_KOKRS
        AND   CSKS~KOSTL IN R_KOSTL
        AND   CSKS~DATBI IN R_DATBI
        AND   CSKS~DATAB IN R_DATAB
        AND   CSKS~ERSDA IN R_ERSDA
        AND   CSKS~PRCTR IN R_PRCTR
        AND   CSKS~SPRAS IN R_SPRAS
        AND   CSKS~SPRAS NE SPACE.
  WHEN OTHERS.
  ENDCASE.
  IF SY-SUBRC <> 0.
* Implement suitable error handling here
  ENDIF.
  IF T_DATA[] IS NOT INITIAL AND LV_LANG_REF_FLD EQ 'KOSTL'.
    SORT T_DATA[] BY LTEXT.
    DELETE T_DATA[] WHERE LTEXT IS NOT INITIAL.
  ELSE.
    IF T_DATA[] IS NOT INITIAL.
      SELECT *
      FROM CSKT
      INTO TABLE LT_CSKT
      FOR ALL ENTRIES IN T_DATA[]
      WHERE SPRAS EQ T_DATA-SPRAS
      AND   KOKRS EQ T_DATA-KOKRS
      AND   KOSTL EQ T_DATA-KOSTL
      AND   DATBI EQ T_DATA-DATBI
      AND   SPRAS NE SPACE
      AND   LTEXT EQ SPACE.
    ENDIF.
    IF LT_CSKT IS NOT INITIAL.
      SORT T_DATA[] BY KOKRS KOSTL DATBI SPRAS.
      SORT LT_CSKT  BY KOKRS KOSTL DATBI SPRAS.
    ENDIF.
    LOOP AT LT_CSKT INTO LS_CSKT WHERE LTEXT IS NOT INITIAL.
      CLEAR LS_DATA.
*        IF ls_cskt-ltext IS NOT INITIAL.
      READ TABLE T_DATA[] INTO LS_DATA WITH KEY KOKRS = LS_CSKT-KOKRS
      KOSTL = LS_CSKT-KOSTL
      DATBI = LS_CSKT-DATBI
      SPRAS = LS_CSKT-SPRAS
      BINARY SEARCH.
      IF SY-SUBRC = 0.
        DELETE T_DATA[] FROM LS_DATA.
      ENDIF.
*        ENDIF.
    ENDLOOP.
  ENDIF.
  READ TABLE T_DATA INTO LS_DATA INDEX 1.
  CHECK SY-TFILL IS NOT INITIAL .
  IS_ALERT = 'X' .
ENDFUNCTION.